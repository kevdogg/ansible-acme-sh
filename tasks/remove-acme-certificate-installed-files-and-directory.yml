---
# Remove deployed (installed) certificate directory for the domain

- name: Check if installed certificate directory exists
  ansible.builtin.stat:
    path: "{{ acme_sh_copy_certs_to_path }}/{{ item.domains | first }}"
  register: installed_dir_result
  failed_when: false
  become: true
  become_user: "{{ acme_sh_become_user | default(omit) }}"

- name: Remove installed certificate directory if it exists
  ansible.builtin.file:
    path: "{{ acme_sh_copy_certs_to_path }}/{{ item.domains | first }}"
    state: absent
  when: installed_dir_result.stat.exists | default(false)
  become: true
  become_user: "{{ acme_sh_become_user | default(omit) }}"
  changed_when: installed_dir_result.stat.exists | default(false)

