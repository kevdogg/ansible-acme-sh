---
- name: "ğŸ“Š ACME Summary Report for {{ inventory_hostname }}"
  ansible.builtin.debug:
    msg: |
      {% set color_reset = '\033[0m' %}
      {% set color_green = '\033[0;32m' %}
      {% set color_yellow = '\033[0;33m' %}
      {% set color_red = '\033[0;31m' %}
      {% set color_cyan = '\033[0;36m' %}
      {% set color_gray = '\033[0;37m' %}

      {% if acme_summary is not defined %}
      âš ï¸  {{ color_yellow }}No summary data available â€” no domains were processed.{{ color_reset }}
      {% else %}
      {{ color_cyan }}ğŸ“‹ Final ACME Summary for {{ inventory_hostname }}{{ color_reset }}
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      {{ color_green }}âœ… Installed:{{ color_reset }} {% for d in acme_summary.installed | default([]) %}{{ d.domain }} {% endfor %}
      {{ color_yellow }}ğŸ” Renewed:  {{ color_reset }}{% for d in acme_summary.renewed | default([]) %}{{ d.domain }} {% endfor %}
      {{ color_gray }}â¸ï¸ Skipped:  {{ color_reset }}{% for d in acme_summary.skipped | default([]) %}{{ d.domain }} {% endfor %}
      {{ color_cyan }}ğŸ—‘ï¸ Removed:  {{ color_reset }}{% for d in acme_summary.removed | default([]) %}{{ d.domain }} {% endfor %}
      {{ color_red }}âŒ Failed:   {{ color_reset }}{% for d in acme_summary.failed | default([]) %}{{ d.domain }} {% endfor %}
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      {% endif %}
  tags: summary

- name: "â„¹ï¸ Legend"
  ansible.builtin.debug:
    msg: |
      {{ '\033[0;32m' }}âœ… Installed{{ '\033[0m' }} â€” new certificates successfully issued and deployed
      {{ '\033[0;33m' }}ğŸ” Renewed{{ '\033[0m' }} â€” existing certificates successfully renewed
      {{ '\033[0;37m' }}â¸ï¸ Skipped{{ '\033[0m' }} â€” issuance skipped (still valid)
      {{ '\033[0;36m' }}ğŸ—‘ï¸ Removed{{ '\033[0m' }} â€” certificates and tracking successfully deleted
      {{ '\033[0;31m' }}âŒ Failed{{ '\033[0m' }} â€” one or more steps failed
  run_once: true
  tags: summary

